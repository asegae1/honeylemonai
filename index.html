<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>honeylemonai - Global</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ¼ãƒ (ãƒãƒ‹ãƒ¼ãƒ¬ãƒ¢ãƒ³) */
    :root { --main: #FFD700; --accent: #FFA500; --bg: #fffdf0; --txt: #333; --ai-bg: #fff; }
    
    /* ãƒ†ãƒ¼ãƒå®šç¾© */
    body.theme-ja { --main: #FFD700; --accent: #FFA500; --bg: #fffdf0; --txt: #333; }
    body.theme-en { --main: #00ffcc; --accent: #0077ff; --bg: #0d1117; --txt: #c9d1d9; --ai-bg: #161b22; }
    body.theme-ko { --main: #ff4d4d; --accent: #3d5afe; --bg: #f8f9fa; --txt: #212529; }
    body.theme-zh { --main: #ee1c25; --accent: #ffcc00; --bg: #fff5f5; --txt: #333; }
    body.theme-fr { --main: #0055a4; --accent: #ef4135; --bg: #ffffff; --txt: #333; }
    body.theme-ar { --main: #007a33; --accent: #c1272d; --bg: #1a1a1a; --txt: #eee; --ai-bg: #2a2a2a; }

    body { font-family: sans-serif; background: var(--bg); color: var(--txt); margin: 0; display: flex; flex-direction: column; height: 100vh; transition: all 0.4s ease; }
    
    /* Header & Logo */
    .header { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid rgba(0,0,0,0.05); }
    .logo { font-weight: 900; font-size: 22px; background: linear-gradient(135deg, var(--main), var(--accent)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; border-left: 5px solid var(--main); padding-left: 12px; }
    
    /* Chat Area */
    #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
    .msg { max-width: 80%; padding: 12px 16px; border-radius: 20px; font-size: 15px; line-height: 1.6; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
    .user { align-self: flex-end; background: linear-gradient(135deg, var(--main), var(--accent)); color: #fff; border-bottom-right-radius: 4px; }
    .ai { align-self: flex-start; background: var(--ai-bg); border: 1px solid rgba(0,0,0,0.05); border-bottom-left-radius: 4px; white-space: pre-wrap; }

    /* Controls */
    .input-area { background: rgba(255,255,255,0.05); padding: 20px; border-top: 1px solid rgba(0,0,0,0.05); }
    .controls { display: flex; gap: 10px; align-items: center; max-width: 1000px; margin: 0 auto; }
    
    select, input[type="text"] { border: 2px solid rgba(0,0,0,0.1); border-radius: 20px; padding: 10px; outline: none; background: var(--ai-bg); color: var(--txt); }
    input[type="text"] { flex: 1; }
    .btn { background: var(--main); border: none; width: 45px; height: 45px; border-radius: 50%; cursor: pointer; font-size: 20px; transition: 0.3s; }
    .btn:hover { transform: scale(1.1); filter: brightness(1.1); }
  </style>
</head>
<body class="theme-ja">

<div class="header">
  <div class="logo" id="ui-logo">honeylemonai</div>
  <select id="langSelect" onchange="changeLang()">
    <option value="ja">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
    <option value="en">English ğŸ‡ºğŸ‡¸</option>
    <option value="ko">í•œêµ­ì–´ ğŸ‡°ğŸ‡·</option>
    <option value="zh">ä¸­æ–‡ ğŸ‡¨ğŸ‡³</option>
    <option value="fr">FranÃ§ais ğŸ‡«ğŸ‡·</option>
    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦</option>
  </select>
</div>

<div id="chat-box"></div>

<div class="input-area">
  <div class="controls">
    <label style="cursor:pointer; font-size:24px;">ğŸ“<input type="file" id="fileInput" style="display:none" onchange="handleFile()"></label>
    <input id="input" type="text" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..." autocomplete="off">
    <button class="btn" id="sendBtn" onclick="run()">ğŸ‹</button>
  </div>
</div>

<script>
  const i18n = {
    ja: { logo: "honeylemonai", place: "ä½•ã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ", theme: "ja" },
    en: { logo: "HONEY LEMON AI", place: "How can I help you?", theme: "en" },
    ko: { logo: "í—ˆë‹ˆ ë ˆëª¬ AI", place: "ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?", theme: "ko" },
    zh: { logo: "èœ‚èœœæŸ æª¬AI", place: "æœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ", theme: "zh" },
    fr: { logo: "CITRON MIEL AI", place: "Comment puis-je vous aider ?", theme: "fr" },
    ar: { logo: "Ø¹Ø³Ù„ Ù„ÙŠÙ…ÙˆÙ†", place: "ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒØŸ", theme: "ar" }
  };

  let currentFile = { name: "", data: "", text: "" };
  let selectedLang = "ja";

  function changeLang() {
    selectedLang = document.getElementById('langSelect').value;
    const config = i18n[selectedLang];
    document.body.className = `theme-${config.theme}`;
    document.getElementById('ui-logo').innerText = config.logo;
    document.getElementById('input').placeholder = config.place;
    addMsg(`System: Switched to ${selectedLang} mode.`, 'ai');
  }

  async function handleFile() {
    const file = document.getElementById('fileInput').files[0];
    if (!file) return;
    currentFile.name = file.name;
    if (file.type.startsWith('image/')) {
      const reader = new FileReader();
      reader.onload = (e) => { currentFile.data = e.target.result; };
      reader.readAsDataURL(file);
    } else if (file.type === 'application/pdf') {
      const arrayBuffer = await file.arrayBuffer();
      const pdfjsLib = window['pdfjs-dist/build/pdf'];
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
      const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
      let t = "";
      for(let i=1; i<=Math.min(pdf.numPages, 5); i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        t += content.items.map(item => item.str).join(' ') + "\n";
      }
      currentFile.text = t;
    } else { currentFile.text = await file.text(); }
    addMsg(`File attached: ${file.name}`, 'ai');
  }

  async function run() {
    const input = document.getElementById('input');
    if (!input.value && !currentFile.name) return;

    const userText = input.value;
    addMsg(userText || currentFile.name, 'user');
    input.value = "";

    try {
      const res = await fetch('/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
          prompt: userText, 
          image: currentFile.data, 
          fileText: currentFile.text,
          lang: selectedLang // AIã«ç¾åœ¨ã®è¨€èªã‚’ä¼ãˆã‚‹
        })
      });
      const data = await res.json();
      addMsg(data.content, 'ai');
    } catch (e) { addMsg("Error connecting to AI.", 'ai'); }
    
    currentFile = { name: "", data: "", text: "" };
  }

  function addMsg(t, type) {
    const b = document.getElementById('chat-box');
    const d = document.createElement('div');
    d.className = `msg ${type}`; d.innerText = t;
    b.appendChild(d); b.scrollTop = b.scrollHeight;
  }
</script>
</body>
</html>
