<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>HoneyLemonAI Pro</title>
    <style>
        :root {
            --bg: #ffffff;
            --side: #f0f4f9;
            --txt: #1f1f1f;
            --blue: #1a73e8;
            --lemon: #f1c40f;
            --border: #dee2e6;
        }
        [data-theme="black"] {
            --bg: #131314;
            --side: #1e1f20;
            --txt: #e3e3e3;
            --border: #444746;
        }
        body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); color: var(--txt); overflow: hidden; }
        
        /* サイドバー */
        .sidebar { width: 280px; background: var(--side); padding: 20px; border-right: 1px solid var(--border); overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--lemon); text-align: center; margin-bottom: 10px; }
        
        .config-item { border-top: 1px solid var(--border); padding-top: 10px; }
        label { font-size: 0.7rem; font-weight: bold; color: var(--blue); display: block; margin-bottom: 5px; }
        textarea, select, input { width: 100%; box-sizing: border-box; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; color: var(--txt); padding: 8px; font-size: 0.8rem; }

        /* メインエリア */
        .main { flex: 1; display: flex; flex-direction: column; align-items: center; position: relative; }
        .chat-container { width: 100%; max-width: 800px; flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 30px; }
        
        /* メッセージスタイル */
        .row { display: flex; gap: 15px; }
        .icon { width: 30px; height: 30px; border-radius: 50%; flex-shrink: 0; }
        .ai-icon { background: linear-gradient(45deg, #4285f4, var(--lemon)); }
        .user-icon { background: #5f6368; }
        .text { flex: 1; line-height: 1.6; font-size: 0.95rem; }

        /* 入力エリア */
        .input-area { width: 100%; max-width: 800px; padding: 20px; box-sizing: border-box; }
        .input-box { background: var(--side); border-radius: 25px; padding: 10px 20px; display: flex; align-items: center; gap: 10px; border: 1px solid transparent; }
        .input-box:focus-within { border-color: var(--border); background: var(--bg); }
        
        .clip { width: 20px; height: 20px; border: 2px solid var(--blue); border-radius: 4px; cursor: pointer; position: relative; }
        .clip::after { content: ""; position: absolute; width: 12px; height: 2px; background: var(--blue); top: 8px; left: 4px; transform: rotate(45deg); box-shadow: 0 4px 0 var(--blue); }
        
        textarea#promptInput { flex: 1; border: none; background: transparent; outline: none; height: 24px; resize: none; font-size: 1rem; color: var(--txt); }
        .send-btn { color: var(--blue); font-weight: bold; cursor: pointer; border: none; background: none; }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="logo">HoneyLemonAI Pro</div>
    <div class="config-item">
        <label>性格設定</label>
        <textarea id="persona">メタ発言はなしで、敬語で考える</textarea>
    </div>
    <div class="config-item">
        <label>モード</label>
        <select id="mode">
            <option value="簡潔に。">高速</option>
            <option value="論理的に。">自動</option>
            <option value="研究者として。">研究者</option>
        </select>
    </div>
    <div class="config-item">
        <label>レート: <span id="rV">1000</span></label>
        <input type="range" id="rate" min="100" max="4000" value="1000" oninput="rV.innerText=this.value">
    </div>
    <div class="config-item">
        <label>テーマ</label>
        <select id="theme" onchange="document.documentElement.setAttribute('data-theme', this.value)">
            <option value="light">ライト</option>
            <option value="black">ブラック</option>
        </select>
    </div>
</aside>

<main class="main">
    <div class="chat-container" id="chatWin">
        <div class="row">
            <div class="icon ai-icon"></div>
            <div class="text">私はAIです。</div>
        </div>
    </div>

    <div class="input-area">
        <div class="input-box">
            <div class="clip" onclick="document.getElementById('fileIn').click()"></div>
            <input type="file" id="fileIn" style="display:none">
            <textarea id="promptInput" placeholder="メッセージを入力"></textarea>
            <button class="send-btn" onclick="send()">送信</button>
        </div>
    </div>
</main>

<script>
    async function send() {
        const input = document.getElementById('promptInput');
        const text = input.value.trim();
        if(!text) return;

        addMsg(text, 'user');
        input.value = '';
        const aiMsg = addMsg("...", 'ai');

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                body: JSON.stringify({
                    prompt: text,
                    model: 'llama-3.1-8b-instant', // Standard固定で安定
                    systemPrompt: document.getElementById('persona').value + "\n" + document.getElementById('mode').value,
                    maxTokens: document.getElementById('rate').value
                })
            });
            const data = await res.json();
            aiMsg.innerText = data.choices[0].message.content;
        } catch (e) {
            aiMsg.innerText = "エラー";
        }
    }

    function addMsg(txt, type) {
        const row = document.createElement('div');
        row.className = 'row';
        const icon = document.createElement('div');
        icon.className = 'icon ' + (type === 'user' ? 'user-icon' : 'ai-icon');
        const text = document.createElement('div');
        text.className = 'text';
        text.innerText = txt;
        row.appendChild(icon);
        row.appendChild(text);
        document.getElementById('chatWin').appendChild(row);
        document.getElementById('chatWin').scrollTop = document.getElementById('chatWin').scrollHeight;
        return text;
    }
</script>
</body>
</html>
