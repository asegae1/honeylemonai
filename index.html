<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>honeylemonai</title>
    <style>
        /* ãƒãƒ‹ãƒ¼ãƒ¬ãƒ¢ãƒ³ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ã—ãŸã‚«ãƒ©ãƒ¼ãƒ‡ã‚¶ã‚¤ãƒ³ */
        body { font-family: sans-serif; max-width: 600px; margin: 20px auto; padding: 20px; background: #fffcf0; color: #444; }
        h1 { color: #f9d71c; text-shadow: 1px 1px 2px #ccc; text-align: center; }
        #output { background: #ffffff; padding: 15px; min-height: 150px; margin: 10px 0; border-radius: 12px; white-space: pre-wrap; border: 2px solid #f9d71c; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        #progress-container { width: 100%; background: #eee; border-radius: 10px; margin: 10px 0; display: none; }
        #progress-bar { width: 0%; height: 20px; background: #f9d71c; border-radius: 10px; text-align: center; line-height: 20px; font-size: 12px; color: #444; font-weight: bold; }
        textarea { width: 100%; height: 80px; background: #fff; color: #444; border: 1px solid #ddd; border-radius: 8px; padding: 10px; box-sizing: border-box; outline: none; }
        button { width: 100%; padding: 12px; background: #f9d71c; color: #444; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; font-weight: bold; font-size: 16px; transition: 0.3s; }
        button:hover { background: #f0c800; }
        button:disabled { background: #eee; color: #aaa; cursor: not-allowed; }
    </style>
</head>
<body>
    <h1>ğŸ‹ honeylemonai</h1>
    <div id="progress-container">
        <div id="progress-bar">0%</div>
    </div>
    <div id="output">honeylemonai ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...</div>
    <textarea id="input" placeholder="honeylemonai ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ã‚‹..."></textarea>
    <button id="sendBtn" disabled>æº–å‚™ä¸­...</button>

    <script type="module">
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.1';

        const outputDiv = document.getElementById('output');
        const sendBtn = document.getElementById('sendBtn');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');

        async function init() {
            try {
                progressContainer.style.display = 'block';
                
                // æ¯”è¼ƒçš„å®‰å®šã—ã¦å‹•ãã‚„ã™ã„ãƒ¢ãƒ‡ãƒ«
                const generator = await pipeline('text-generation', 'onnx-community/Llama-3.2-1B-Instruct-q4f16', {
                    device: 'wasm',
                    progress_callback: (data) => {
                        if (data.status === 'progress') {
                            const p = Math.round(data.progress);
                            progressBar.style.width = p + '%';
                            progressBar.innerText = `èª­ã¿è¾¼ã¿ä¸­: ${p}%`;
                        }
                    }
                });

                outputDiv.innerText = "ã“ã‚“ã«ã¡ã¯ï¼ç§ã¯ honeylemonai ã§ã™ã€‚ä½•ã‚’ãŠæ‰‹ä¼ã„ã—ã¾ã—ã‚‡ã†ã‹ï¼Ÿ";
                sendBtn.disabled = false;
                sendBtn.innerText = "é€ä¿¡";
                progressContainer.style.display = 'none';

                window.ask = async () => {
                    const text = document.getElementById('input').value;
                    if(!text || sendBtn.disabled) return;
                    
                    sendBtn.disabled = true;
                    sendBtn.innerText = "è€ƒãˆä¸­...";
                    outputDiv.innerText = "honeylemonai ãŒè€ƒãˆã¦ã„ã¾ã™...";

                    try {
                        const output = await generator([{ role: "user", content: text }], { max_new_tokens: 128 });
                        outputDiv.innerText = output[0].generated_text.at(-1).content;
                    } catch (err) {
                        outputDiv.innerText = "ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦ã—ã¾ã„ã¾ã—ãŸ...ã‚‚ã†ä¸€åº¦è©¦ã—ã¦ãã ã•ã„ã€‚";
                    } finally {
                        sendBtn.disabled = false;
                        sendBtn.innerText = "é€ä¿¡";
                    }
                };
                sendBtn.onclick = window.ask;

            } catch (e) {
                outputDiv.innerText = "èµ·å‹•ã‚¨ãƒ©ãƒ¼: " + e.message;
            }
        }
        init();
    </script>
</body>
</html>
