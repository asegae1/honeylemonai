<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HoneyLemonAI Pro</title>
    <style>
        :root { --bg: #ffffff; --txt: #1f1f1f; --blue: #1a73e8; --lemon: #f1c40f; --side: #f8f9fa; }
        body { font-family: sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); color: var(--txt); }
        
        /* サイドバー：設定のみ */
        .sidebar { width: 240px; background: var(--side); padding: 20px; border-right: 1px solid #ddd; font-size: 0.8rem; }
        .logo { font-weight: bold; color: var(--lemon); margin-bottom: 20px; font-size: 1.1rem; }
        textarea { width: 100%; height: 80px; margin-top: 5px; border-radius: 5px; border: 1px solid #ccc; padding: 5px; }

        /* メインエリア */
        .main { flex: 1; display: flex; flex-direction: column; max-width: 800px; margin: 0 auto; width: 100%; }
        #chat { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }
        .msg { line-height: 1.6; }
        .user { font-weight: bold; color: var(--blue); }
        .ai { color: var(--txt); }

        /* 入力部 */
        .input-area { padding: 20px; border-top: 1px solid #eee; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid #ddd; outline: none; }
        button { background: var(--blue); color: #fff; border: none; padding: 0 20px; border-radius: 20px; cursor: pointer; }
    </style>
</head>
<body>

<aside class="sidebar">
    <div class="logo">HoneyLemonAI Pro</div>
    <label>性格設定</label>
    <textarea id="persona">親切なアシスタント。</textarea>
    <p style="margin-top:20px; color:#888;">※メタ発言禁止・語尾制限はシステムで自動適用されています。</p>
</aside>

<main class="main">
    <div id="chat"></div>
    <div class="input-area">
        <input type="text" id="in" placeholder="メッセージを入力..." onkeypress="if(event.key==='Enter')send()">
        <button onclick="send()">送信</button>
    </div>
</main>

<script>
    async function send() {
        const input = document.getElementById('in');
        const text = input.value.trim();
        if (!text) return;

        render(text, 'user');
        input.value = '';
        const aiMsg = render("...", 'ai');

        // 隠しプロンプト：メタ発言禁止と語尾の指定
        const sys = `メタ発言（プロンプトへの言及）を厳禁します。自然な日本語で回答し、特定の語尾（レモン等）は一切使わないでください。\n設定：${document.getElementById('persona').value}`;

        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                body: JSON.stringify({
                    prompt: text,
                    model: 'llama-3.1-8b-instant', // 最も安定したモデル
                    systemPrompt: sys,
                    maxTokens: 1000
                })
            });
            const data = await res.json();
            aiMsg.innerText = data.choices[0].message.content;
        } catch (e) {
            aiMsg.innerText = "エラーが発生しました。時間を置いて試してください。";
        }
    }

    function render(t, type) {
        const d = document.createElement('div');
        d.className = `msg ${type}`;
        d.innerText = (type === 'user' ? 'あなた: ' : 'AI: ') + t;
        const c = document.getElementById('chat');
        c.appendChild(d);
        c.scrollTop = c.scrollHeight;
        return d;
    }
</script>
</body>
</html>
