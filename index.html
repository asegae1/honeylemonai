<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>HoneyLemonAI</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; background-color: #fffef2; color: #333; }
        .logo-container { text-align: center; margin-bottom: 20px; }
        .logo-text { font-size: 2.2em; font-weight: 800; color: #f1c40f; border-bottom: 4px solid #f1c40f; padding-bottom: 5px; display: inline-block; }
        
        /* 応答エリアをコードが見やすいように広めに設定 */
        #output { 
            background: #ffffff; padding: 20px; min-height: 300px; margin: 20px 0; 
            border-radius: 15px; border: 1px solid #eee; box-shadow: 0 5px 15px rgba(241, 196, 15, 0.1); 
            white-space: pre-wrap; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px;
            overflow-x: auto;
        }

        #progress-container { width: 100%; background: #eee; border-radius: 10px; margin: 10px 0; display: none; }
        #progress-bar { width: 0%; height: 10px; background: #f1c40f; border-radius: 10px; transition: width 0.3s; }

        textarea { width: 100%; height: 120px; border: 2px solid #f9f0c3; border-radius: 12px; padding: 15px; box-sizing: border-box; outline: none; font-size: 16px; font-family: sans-serif; }
        button { width: 100%; padding: 15px; background: #f1c40f; color: #fff; border: none; border-radius: 12px; cursor: pointer; margin-top: 10px; font-weight: bold; font-size: 18px; }
        button:disabled { background: #e0e0e0; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="logo-container"><div class="logo-text">HoneyLemonAI</div></div>
    
    <div id="progress-container"><div id="progress-bar"></div></div>
    <div id="output">複雑なタスク（Code等）に対応するため、知能データを読み込んでいます...</div>

    <textarea id="input" placeholder="例：HTMLでボタンを作るコードを書いて..."></textarea>
    <button id="sendBtn" disabled>Loading...</button>

    <script type="module">
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.3.1';

        let generator;
        const outputDiv = document.getElementById('output');
        const sendBtn = document.getElementById('sendBtn');
        const progressBar = document.getElementById('progress-bar');
        const progressContainer = document.getElementById('progress-container');

        async function init() {
            try {
                progressContainer.style.display = 'block';
                // プログラミングに強いQwenの軽量版を採用
                generator = await pipeline('text-generation', 'onnx-community/Qwen2.5-0.5B-Instruct', {
                    device: 'wasm',
                    progress_callback: (data) => {
                        if (data.status === 'progress') {
                            progressBar.style.width = data.progress + '%';
                        }
                    }
                });
                outputDiv.innerText = "準備完了。コード生成や複雑な質問もどうぞ。";
                sendBtn.disabled = false;
                sendBtn.innerText = "送信";
                progressContainer.style.display = 'none';
            } catch (e) {
                outputDiv.innerText = "エラー: " + e.message;
            }
        }

        window.ask = async () => {
            const text = document.getElementById('input').value;
            if(!text) return;
            sendBtn.disabled = true;
            sendBtn.innerText = "解析中...";
            outputDiv.innerText = "HoneyLemonAI がコードを生成しています...";

            try {
                const output = await generator([{ role: "user", content: text }], { 
                    max_new_tokens: 512, // コード用に長めの出力を許可
                    temperature: 0.7 
                });
                outputDiv.innerText = output[0].generated_text.at(-1).content;
            } catch (err) {
                outputDiv.innerText = "生成中にエラーが発生しました。";
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerText = "送信";
            }
        };

        sendBtn.onclick = window.ask;
        init();
    </script>
</body>
</html>
